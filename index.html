<!doctype html>
<html>
<head>
    <!-- Latest compiled and minified CSS -->
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="jquery.fullPage.css" />
	<link rel="manifest" href="manifest2.json" />
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
    <!-- adding vorlon for testing on all the differetn devices-->
    <script src="http://vorlonjsdd11.azurewebsites.net/vorlon.js"></script>
    <link href="animate.css" rel="stylesheet" />
    <style>
        html {
        xcolor: white;
        background-color:#3DC0F1;
        }

            input[type=text]:not([readonly]):focus, input[type=password]:not([readonly]):focus, input[type=email]:not([readonly]):focus, input[type=url]:not([readonly]):focus, input[type=time]:not([readonly]):focus, input[type=date]:not([readonly]):focus, input[type=datetime-local]:not([readonly]):focus, input[type=tel]:not([readonly]):focus, input[type=number]:not([readonly]):focus, input[type=search]:not([readonly]):focus, textarea:not([readonly]).materialize-textarea:focus {
            border-color: yellow;
            }
        .boxNumber, .answerBox input {
        font-size:7em;
        height: auto;
        }
        .factorBox {
            font-size:3em;
        }

        .groupBox {
        position: absolute;
        top:0;
        }
        #firstBox {
        transform:rotate(5deg)
        }
        #secondBox {
        transform: rotate(-5deg)
        }
        #youWin {
        position: absolute;
        top: 20%;
        z-index:100;    

        }

        body {
        background-image: url('images/cloudbg.png'); 
        background-position: center; 
        background-attachment: fixed; 
        min-height:100%; 
        background-size:contain;
        
        
        }

        #c2canvasdiv input[type=button] {
            opacity: .01;
        }

        #c2canvasdiv input[type=text] {
        font-size:1.4em !important;
        color:#f4d635;
        border-bottom:none;
        }

        #keyboard {
        font-size:1.4em;
        background-color: rgba(255, 255, 255, 0.5);
        padding: 1em;
        border: 1px solid white;
        border-radius: .2em;
        }

    </style>



    <title>math game</title>
</head>
<body style="">

    <div id="fullpage" class="fullpage-wrapper">
        <div class="section" id="settings">

            <div class="container center ">
                <div class="row">
                    <div class="col s12">
                        <div class="card-panel">
                            <div class="row">
                                <div class="input-field col s12">
                                    <label for="topNumber" id="basic-addon1">Enter first numbers</label>
                                    <input id="topNumber" type="text" class="form-control" placeholder="ex. 0, 1, 2, 3" aria-describedby="basic-addon1" />
                                </div>
                            </div>

                            <div class="row">
                                <div class="input-field col s12">
                                    <label for="bottomNumber" id="basic-addon2">Enter second numbers</label>
                                    <input id="bottomNumber" type="text" class="form-control" placeholder="ex. 1, 3, 5-7" aria-describedby="basic-addon2" />
                                </div>
                            </div>
                            <button id="setValues" class="btn btn-primary btn-lg">set number ranges</button>
                            <a href="/#secondPage" class="btn btn-primary btn-lg"> close settings</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="section active" id="learning">
            <div  class=" container center "><div id="youWin" class="row animated hide"><img class="responsive-img" src="win.png" /></div></div>

            <div class="container center  " id="problemSection">
                

                <div class="row">
                    <div class="col s12 m3">
                        <div class="card white darken-1 animated" id="firstBox">
                            <div class="card-content black-text">
                                <p id="firstNumberBox" class="boxNumber ">

                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col s6 m1 ">
                        <div class="darken-1">
                            <div class="card-content black-text">
                                <p id="factorateBox" class="factorBox">
                                    x
                                </p>
                            </div>
                        </div>
                    </div>


                    <div class="col s6 m3">
                        <div class="card white darken-1 animated" id="secondBox">
                            <div class="card-content black-text">
                                <p id="secondNumberBox" class="boxNumber ">

                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col s6 m1">
                        <div class="darken-1">
                            <div class="card-content black-text">
                                <p id="equals" class="factorBox">
                                    =
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col s6 m3">
                        <div class="card white darken-1">
                            <div class="card-content black-text">
                                <p id="answerCard" class="answerBox">
                                    <input type="text" id="answerBox" class="form-control" />
                                    <button id="sendAnswer" class="btn btn-primary btn-lg">answer</button>

                                </p>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="container center">
                    <div class="row">
                        <div class="chip" id="coinTotal">
                        </div>
                        <div class="chip" id="setup">
                            <a href="/#firstPage">  setup</a>
                        </div>
                        <div class="chip" id="play">
                          <a href="/#thirdPage">play</a>  
                        </div>
                        <div class="chip" id="keyboard-btn">
                            <a href="#">keyboard</a>
                        </div>
                    </div>
                </div>


            </div>
            <div class=" container center ">
                <div class="row hide animated" id="keyboard">
                    <div class="col s1" ><button class="btn btn-large blue-grey">1</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">2</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">3</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">4</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">5</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey"   >6</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">7</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">8</button></div>
                    <div class="col s1" ><button class="btn btn-large blue-grey">9</button> </div>
                    <div class="col s1"><button class="btn btn-large blue-grey ">0</button></div>
                    <div class="col s1" ><button class="btn btn-large red" actionKey="delete">&lArr;</button></div>

                </div>


            </div>
            </div>
        <div id="gameing" class="section">

            <div class="center ">

                <div id="c2canvasdiv">

                    <!-- The canvas the project will render to.  If you change its ID, don't forget to change the
            ID the runtime looks for in the jQuery events above (ready() and cr_sizeCanvas()). -->
                    <canvas id="c2canvas" width="854" height="600" class="responsive-img"> </canvas>

                </div>
            </div>



            </div>
</div>

    <script type="text/javascript" src="jquery-2.1.1.min.js"></script>

        <script type="text/javascript" src="jquery.fullPage.js"></script>

  
    <!-- Compiled and minified JavaScript -->
    <script src="materialize.min.js"></script>

        <!-- This following line is optional. Only necessary if you use the option css3:false and you want to use other easing effects rather than "linear", "swing" or "easeInOutCubic". -->
        <xscript src="vendors/jquery.easings.min.js"></xscript>

    <!-- The runtime script.  You can rename it, but don't forget to rename the reference here as well.
    This file will have been minified and obfuscated if you enabled "Minify script" during export. -->
    <script src="c2runtime.js"></script>
    
        <script>
            var mathState;
            
            //this is extra check that doesn't have to use URL for kindle fire
            if (localStorage.getItem("mathState") !== null || document.location.href.match('addition')) {

                mathState = 'addition';
                localStorage.setItem("mathState", "addition");

            }

            if (mathState == 'addition') document.getElementById('factorateBox').innerHTML = '+';

            $(document).ready(function () {
                $('#fullpage').fullpage({ 
                    anchors: ['firstPage', 'secondPage', 'thirdPage'],
                    afterLoad: function(anchorLink, index){
                        var loadedSection = $(this);

                        //using index
                        if(index == 3){
                    //        alert("Section 3 ended ");
                        }

                        //using anchorLink
                        if (anchorLink == 'thirdPage') {
                            cr_createRuntime("c2canvas");
                            cr_setSuspended(false);
                        }

                        //when go back to center page, update from local storage in case it has changed

                        if (anchorLink == 'secondPage') {

                            localforage.getItem('total', function (err, value) {
                                if (err || isNaN(value) == true) {
                                    localforage.setItem('total', 33);
                                    coinCount = 33;
                                    coinCounter();
                                    //  cr_createRuntime("c2canvas");
                                } else {
                                    coinCount = value;
                                    coinCounter();
                                    //  cr_createRuntime("c2canvas");
                                }
                            });
                            cr_setSuspended(true);

                        }

                    }

                });
            });


            //UI behavior
            var setup = document.getElementById('setup');
            var settings = document.getElementById('settings')
            var learning = document.getElementById('learning');
            var firstBox = document.getElementById('firstBox');
            var secondBox = document.getElementById('secondBox');

            setup.addEventListener('click', function () {


            });

        </script>

        <script>

            //helpers //

            Array.prototype.randomPosition = function () {
                return this[Math.floor(Math.random() * this.length)]
            }


            //end helpers//

            //set up web audio context //
            var context, winSound, wrongSound, inSound, outSound, rightSound;

                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                context = new AudioContext();

                var sounds = [
                       'sounds/cartoon_fast_whoosh_good_for_karate_chop_other_fast_movement_or_swipe_004.mp3',
                       'sounds/cartoon_fast_whoosh_good_for_karate_chop_other_fast_movement_or_swipe_006.mp3',
                       'sounds/comedy_accent_crash_and_burn.mp3',
                       'sounds/comedy_single_toot_of_a_bicycle_horn.mp3',
                       'sounds/small_bell_hotel_reception_or_elevator_ring_002.mp3',
                       'sounds/office_stapler_single_sound_manual.mp3'
                ];



                function loadSounds(url, ref) {
                    var request = new XMLHttpRequest();
                    request.open('GET', url, true);
                    request.responseType = 'arraybuffer';

                    // Decode asynchronously
                    request.onload = function () {
                        context.decodeAudioData(request.response, function (buffer) {
                            if (ref === 'inSound') inSound = buffer;
                            if (ref === 'outSound') outSound = buffer;
                            if (ref === 'winSound') winSound = buffer;
                            if (ref === 'wrongSound') wrongSound = buffer;
                            if (ref === 'rightSound') rightSound = buffer;
                            if (ref === 'keySound') keySound = buffer;
                        }, function (er) { console.log(er) });
                    }
                    request.send();
                };


                loadSounds(sounds[0], 'inSound');
                loadSounds(sounds[1], 'outSound');
                loadSounds(sounds[2], 'winSound');
                loadSounds(sounds[3], 'wrongSound');
                loadSounds(sounds[4], 'rightSound');
                loadSounds(sounds[5], 'keySound');
                function playSound(buffer) {
                   // return
                    var source = context.createBufferSource(); // creates a sound source
                    source.buffer = buffer;                    // tell the source which sound to play
                    source.connect(context.destination);       // connect the source to the context's destination (the speakers)
                    source.start(0);                           // play the source now
                    // note: on older systems, may have to use deprecated noteOn(time);
                }


            
            var td = document.getElementById('targetDiv');
            var topNumber = [1,2,3,4];
            var bottomNumber = [1,2,3,4];

            var ab = document.getElementById('answerBox');
            var usedCombos = [];
            var sa = document.getElementById('sendAnswer');
            var currentProblem = [];

            //if (!localStorage.coinCount) localStorage.setItem('coinCount', 0);
            var coinCount = '...counting'; //localStorage.coinCount;

            localforage.getItem('total', function (err, value) {
                if (err) {
                    localforage.setItem('total', 33);
                    coinCount = 33;
                    coinCounter();
                  //  cr_createRuntime("c2canvas");
                } else {
                    coinCount = value;
                    coinCounter();
                  //  cr_createRuntime("c2canvas");
                }
            });

            //set listener to button so that you can set range

            var setRange = function () {
                //set up numbers from DOM
                var topNumFree = document.getElementById('topNumber').value.split(',');
                var buttomNumFree = document.getElementById('bottomNumber').value.split(',');

                if (topNumFree[0] == "" || buttomNumFree[0] == "") {
                    return
                }
                topNumber = [];
                for (var i = 0; topNumFree.length > 0;) {
                    if (topNumFree[i].indexOf('-') !== -1) {
                        
                        var range = topNumFree[i].split('-');
                        topNumber.push(parseFloat(range[0]));

                        var b = parseFloat(range[0]);
                        while (b < parseFloat(range[1])) {
                              b += 1;
                              topNumber.push(b);
                          }
                         var looseit = topNumFree.shift(0);

                    } else {

                        topNumber.push(topNumFree.shift(0));
                    }
                }

                bottomNumber = [];
                for (var i = 0; buttomNumFree.length > 0;) {
                    if (buttomNumFree[i].indexOf('-') !== -1) {

                        var range = buttomNumFree[i].split('-');
                        bottomNumber.push(parseFloat(range[0]));

                        var b = parseFloat(range[0]);
                        while (b < parseFloat(range[1])) {
                            b += 1;
                            bottomNumber.push(b);
                        }
                        var looseit = buttomNumFree.shift(0);

                    } else {

                        bottomNumber.push(buttomNumFree.shift(0));
                    }
                }
               // for (var i = 0; buttomNumFree.length > 0; i++) {
                //    bottomNumber.push(buttomNumFree.pop());
               // }

                usedCombos = [];
                chooseProblem();
                //add in the link to scroll down
                $.fn.fullpage.moveTo(2
                    );

            };

            //this is where we pick the values for the problem
            var setValueArray = function () {
                //make random number picks
                currentProblem = [];
                currentProblem.push(topNumber.randomPosition());
                currentProblem.push(bottomNumber.randomPosition());
                return currentProblem;
            }

            var chooseProblem = function () {


                //add loop counter to make sure you get them all but don't loop for ever
                //var loopCounter = 0;
                var counterMax = topNumber.length * bottomNumber.length;
                //loop through the used answers to make sure none of them match the current one
                //you will need to reset toe used answers array if you want to start a new round
                //pick a problem
                var curValue = [];
                curValue = setValueArray();
                //var curValueStr = '';
                //turn values into sring to compare to used answers
                curValueStr = problemToString(curValue);
                //you know you have tried all the options when your array is the same size as the option set
                if (usedCombos.length == counterMax) {
                    //alert('you win');
                    $('#youWin').addClass('bounceIn');
                    $('#youWin').removeClass('hide');
                    $('#problemSection').addClass('hide');
                    playSound(winSound);
                    //bonus 10 points for winning the round
                    coinCount+= 10;
                    coinCounter();

                    return
                }
                //check against used answers for dubs
                for (i = 0; i < usedCombos.length; i++) {

                    if (usedCombos[i] == curValueStr) {
                        chooseProblem()
                    }
                }

                //if dup, pick a different problem
                //also know how many different picks you should make


                //print out the problem when you know it's new
                printProblem(currentProblem);
            };
            var printProblem = function (problem) {
                //targ.innerHTML = problem;
                document.getElementById('firstNumberBox').innerHTML = problem[0];
                document.getElementById('secondNumberBox').innerHTML = problem[1];


            }

            var problemToString = function (problem) {
                var problemString = '';
                for (i = 0; i < problem.length; i++) {

                    problemString += problem[i];
                    if (i < problem.length - 1) problemString += ' x '
                }
                return problemString
            };


            var calculate = function () {
                var checkCorrect = (currentProblem[0] * currentProblem[1]).toString() == ab.value;
                if (mathState == 'addition') {
                    checkCorrect = (currentProblem[0] + currentProblem[1]).toString() == ab.value;
                };
                if (checkCorrect) {

                    firstBox.classList.add('bounceOutDown');
                    secondBox.classList.add('bounceOutDown');
                    playSound(rightSound);
                    sa.setAttribute('disabled', 'dispabled');
                    setTimeout(function () { playSound(inSound); }, 500);


                    setTimeout(function () {
                        $(firstBox).removeClass('bounceOutDown');
                        $(secondBox).removeClass('bounceOutDown');
                        usedCombos.push(problemToString(currentProblem));
                        coinCount++;
                        coinCounter();
                        chooseProblem();
                        ab.value = '';
                        ab.focus();
                        //turn button back on
                        sa.removeAttribute('disabled');
                        $(firstBox).addClass('bounceInUp');
                        $(secondBox).addClass('bounceInUp');
                        setTimeout(function () { playSound(outSound); }, 500);
                        setTimeout(function () {
                            $(firstBox).removeClass('bounceInUp');
                            $(secondBox).removeClass('bounceInUp');
                        }, 1000)

                    }, 1500);

                } else {
                  //  alert(currentProblem[0] * currentProblem[1])
                    //  alert('wrong');
                    $(firstBox).addClass('swing');
                    $(secondBox).addClass('swing');
                    playSound(wrongSound);

                    setTimeout(function () {
                        $(firstBox).removeClass('swing');
                        $(secondBox).removeClass('swing');
                    }, 1000)
                }
            };

            var coinCounter = function () {
                document.getElementById('coinTotal').innerHTML = 'You Have ' + coinCount + ' coins';
                // localStorage.coinCount = coinCount;
                localforage.setItem('total', coinCount);

            };

            sa.addEventListener('click', calculate);
            $(document).keypress(function (e) {
                if (e.which == 13) {
                    calculate()
                }
            });



            document.getElementById('setValues').addEventListener('click', setRange);

            $('#youWin img').click(function () {
                //$('#youWin').removeClass('bounceIn');
                $('#youWin').addClass('hide');
                $('#problemSection').removeClass('hide');
                usedCombos = [];
                currentProblem = [];
                chooseProblem();
                coinCounter();
                ab.focus();
               


            });
            //ab.addEventListener('submit', calculate);
            //setups
            chooseProblem();
            coinCounter();
            ab.focus();
        </script>




    <script>
        //game launch

  


		// Size the canvas to fill the browser viewport.
		jQuery(window).resize(function() {
			cr_sizeCanvas(jQuery(window).width(), jQuery(window).height());
		});

		// Start the Construct 2 project running on window load.
		jQuery(document).ready(function ()
		{
			// Create new runtime using the c2canvas
			//cr_createRuntime("c2canvas");
		});

		// Pause and resume on page becoming visible/invisible
		function onVisibilityChanged() {
			if (document.hidden || document.mozHidden || document.webkitHidden || document.msHidden)
				cr_setSuspended(true);
			else
				cr_setSuspended(false);
		};

		document.addEventListener("visibilitychange", onVisibilityChanged, false);
		document.addEventListener("mozvisibilitychange", onVisibilityChanged, false);
		document.addEventListener("webkitvisibilitychange", onVisibilityChanged, false);
		document.addEventListener("msvisibilitychange", onVisibilityChanged, false);


    </script>
    <script>
        //keyboard code;

        var kbButton = document.getElementById('keyboard-btn');
        var keyboard = document.getElementById('keyboard');

        kbButton.addEventListener('click', function () {
            console.log('in the keybaord event')
            if ($(keyboard).hasClass('hide')) {
                setTimeout(function () { playSound(inSound); }, 500);
                console.log('show the keyboard');
                $(keyboard).addClass('bounceInUp');
                $(keyboard).removeClass('hide');
                ab.setAttribute('readonly', 'readonly')
                setTimeout(function () {
                    $(keyboard).removeClass('bounceInUp');
                }, 1000)

            }else{
                // $(keyboard).addClass('hide');
                setTimeout(function () { playSound(outSound); }, 500);
                $(keyboard).addClass('bounceOut');
                ab.removeAttribute('readonly');
                setTimeout(function () {
                    $(keyboard).addClass('hide');
                    $(keyboard).removeClass('bounceOut');
                }, 1000)
            }

           

        });

        //set listeners for keyboard

        keyboard.addEventListener('click', function (e) {
            console.log(e.target);
            playSound(keySound);
            var targ = e.target;
            if (targ.innerHTML.match('button')) {
                targ = targ.children[0];
                //this could probably be a loop but since it can only be two layers deep this should work everywereh
                if (targ.innerHTML.match('button')) {
                    targ = targ.children[0];
                }
            }

                if (targ.getAttribute('actionKey') === 'delete') {
                ab.value = '';
            } else {
                    ab.value += targ.innerHTML;
            }
        }, true);



    </script>
</body>
	
</html>
	